# Дмитрий Воловиков - "LyceumDocBot"

# Пользовательские сценарии

### Группа: 11 - И - 1

### Электронная почта: volovikov.dvs@gmail.com

### Tg: @Pug0077

**FR1.** Пользователь регистрируется, входит в аккаунт, выходит из аккаунта, восстанавливает/меняет пароль.
**FR2.** Пользователь задаёт вопрос по документам лицея в формате чата.
**FR3.** Система формирует ответ **только на основе документов** и добавляет ссылки на источники (цитаты/фрагменты).
**FR4.** Пользователь открывает источники: видит документ, страницу/раздел и подсветку фрагмента.
**FR5.** Пользователь выполняет поиск по ключевым словам по корпусу документов и фильтрует результаты.
**FR6.** Пользователь просматривает историю запросов и повторно открывает ответ/контекст.
**FR7.** Пользователь экспортирует ответ в PDF (с источниками).
**FR8.** Администратор загружает новый документ и запускает индексацию.
**FR9.** Администратор модерирует документы (публикует/отклоняет/удаляет).
**FR10.** Администратор управляет пользователями (роль, блокировка, сброс пароля).


## Сценарий 1 (FR1): Регистрация, вход и восстановление пароля

1. **Пользователь открывает** страницу входа и выбирает действие «Регистрация».
2. **Пользователь вводит** имя, email и пароль и подтверждает регистрацию.
3. **Система проверяет** корректность email и сложность пароля и отклоняет форму при ошибке.
4. **Система создаёт** аккаунт и отправляет письмо/код подтверждения (или подтверждает сразу, если подтверждение не требуется).
5. **Пользователь вводит** код подтверждения и завершает регистрацию.
6. **Пользователь вводит** логин и пароль и нажимает «Войти».
7. **Система проверяет** пароль и показывает сообщение об ошибке при неверных данных.
8. **Пользователь выбирает** «Забыли пароль?» и задаёт новый пароль после получения кода/ссылки.


## Сценарий 2 (FR2): Задание вопроса в чат и получение чернового результата

1. **Пользователь открывает** страницу «Чат с документами».
2. **Пользователь вводит** вопрос в поле ввода и нажимает «Отправить».
3. **Система валидирует** длину вопроса и показывает предупреждение, если вопрос слишком длинный или пустой.
4. **Система создаёт** запись запроса в базе данных и присваивает ему ID.
5. **Система показывает** индикатор обработки и блокирует повторную отправку до завершения.
6. **Система возвращает** ответ в чат, когда генерация завершена.
7. **Система показывает** уведомление об ошибке, если модель/поиск недоступны, и предлагает повторить попытку.
8. **Пользователь уточняет** вопрос и повторно отправляет сообщение при необходимости.

## Сценарий 3 (FR3): Ответ с обязательными цитатами и режим “не знаю”

1. **Пользователь задаёт** вопрос, который требует опоры на документы лицея.
2. **Система извлекает** кандидаты фрагментов через поиск (BM25 + векторный поиск).
3. **Система переранжирует** кандидатов и формирует контекст из топ-фрагментов.
4. **Система генерирует** ответ, требуя ссылки вида `[S1]`, `[S2]` для каждого факта.
5. **Система проверяет** наличие ссылок в ответе и запрашивает перегенерацию при нарушении формата.
6. **Система отвечает** «Не знаю» и объясняет, что в документах нет подтверждения, если релевантного контекста не найдено.
7. **Система сохраняет** ответ, контекст и список источников в базе данных.
8. **Пользователь читает** ответ и при необходимости переходит к источникам.


## Сценарий 4 (FR4): Просмотр источников и переход к фрагменту в документе

1. **Пользователь нажимает** на ссылку источника `[S#]` под ответом.
2. **Система открывает** карточку источника с названием документа, страницей/разделом и фрагментом текста.
3. **Пользователь выбирает** действие «Открыть документ» в просмотрщике.
4. **Система показывает** документ на нужной странице и подсвечивает найденный фрагмент.
5. **Система сообщает** об ошибке, если файл удалён/недоступен, и предлагает открыть другой источник.
6. **Пользователь переключает** источники, если их несколько, и сравнивает фрагменты.
7. **Пользователь сохраняет** ссылку на источник (копирует) при необходимости.
8. **Система логирует** факт открытия источника для статистики (без хранения содержимого вопроса у админа).


## Сценарий 5 (FR5): Поиск по ключевым словам и фильтрация результатов

1. **Пользователь открывает** страницу «Поиск по документам».
2. **Пользователь вводит** ключевую фразу и нажимает «Найти».
3. **Система выполняет** текстовый поиск и показывает список совпадений с контекстом.
4. **Пользователь выбирает** фильтр по типу документа или категории (например, «регламенты», «учебный план»).
5. **Система обновляет** выдачу с учётом фильтра и сортировки по релевантности.
6. **Пользователь открывает** результат и переходит к странице/разделу документа.
7. **Система показывает** сообщение «Ничего не найдено» и предлагает изменить запрос при пустой выдаче.
8. **Пользователь уточняет** запрос и повторяет поиск.

## Сценарий 6 (FR6): История запросов и повторное открытие ответа

1. **Пользователь открывает** страницу «История».
2. **Система показывает** список запросов пользователя с датой и коротким превью.
3. **Пользователь выбирает** конкретный запрос из списка.
4. **Система открывает** сохранённый ответ, контекст и список источников.
5. **Пользователь нажимает** «Повторить запрос» для обновления ответа по актуальным документам.
6. **Система запускает** повторную обработку и сохраняет новую версию ответа.
7. **Система сообщает** об ошибке, если запрос не найден (например, удалён), и предлагает вернуться в список.
8. **Пользователь удаляет** запись истории (только свою) при необходимости.


## Сценарий 7 (FR7): Экспорт ответа в PDF

1. **Пользователь открывает** ответ на странице чата или в истории.
2. **Пользователь нажимает** кнопку «Экспорт в PDF».
3. **Система формирует** документ PDF, включая вопрос, ответ и список источников.
4. **Система добавляет** метаданные источников (документ, страница/раздел, дата).
5. **Система показывает** предпросмотр и кнопку «Скачать».
6. **Система сообщает** об ошибке генерации PDF и предлагает повторить попытку при сбое.
7. **Пользователь скачивает** PDF на устройство.
8. **Система сохраняет** факт экспорта в базе данных (для истории пользователя).


## Сценарий 8 (FR8): Загрузка нового документа и индексация

1. **Администратор открывает** панель администратора и выбирает «Документы».
2. **Администратор загружает** файл (PDF/TXT/MD) и вводит название и категорию.
3. **Система проверяет** формат и размер файла и отклоняет загрузку при нарушении ограничений.
4. **Система сохраняет** файл в серверное хранилище и создаёт запись в базе данных.
5. **Система извлекает** текст, очищает его и разбивает на чанки.
6. **Система строит** эмбеддинги и обновляет индекс (FAISS/BM25) без потери старых данных.
7. **Система показывает** статус индексации и сообщение об ошибке при проблемах парсинга.
8. **Администратор повторяет** индексацию или помечает документ как “нужна проверка” при ошибке.


## Сценарий 9 (FR9): Модерация и публикация документа

1. **Администратор открывает** список документов со статусами «на проверке / опубликован / отклонён».
2. **Администратор выбирает** документ со статусом «на проверке».
3. **Система показывает** превью текста, метаданные и качество извлечения (например, количество пустых страниц).
4. **Администратор подтверждает** публикацию или выбирает «Отклонить» с причиной.
5. **Система публикует** документ и делает его доступным для поиска и RAG-ответов.
6. **Система исключает** отклонённый документ из индекса и выдачи.
7. **Система сообщает** об ошибке прав доступа, если действие выполняет не администратор.
8. **Администратор удаляет** документ и связанные данные из системы при необходимости.

## Сценарий 10 (FR10): Управление пользователями и ролями

1. **Администратор открывает** раздел «Пользователи» в админ-панели.
2. **Система показывает** список пользователей с ролью и статусом (активен/заблокирован).
3. **Администратор ищет** пользователя по email или имени и открывает карточку.
4. **Администратор меняет** роль пользователя (например, “учитель” / “ученик” / “админ”) и сохраняет изменения.
5. **Система проверяет** права и отклоняет изменение роли при попытке удалить последнего администратора.
6. **Администратор блокирует** пользователя при нарушениях и подтверждает действие.
7. **Система завершает** активные сессии пользователя и запрещает вход до разблокировки.
8. **Администратор выполняет** сброс пароля пользователя и отправляет инструкцию на email (или выдаёт временный пароль).
